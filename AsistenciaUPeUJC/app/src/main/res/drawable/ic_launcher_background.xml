}),function(n){var t;(function(t){function i(t,i,r){var u=n.getRequestMetadata(t,r);return n.mergeArgsIntoUrl(i,u)}function r(t,i,r,u,f,e){var o={url:t,accessToken:e,requestType:"POST",body:JSON.stringify(i),timeout:u,headers:f,onSuccess:r.onSuccess,onError:r.onError};n.augmentMsbMtAjax(o,"caller: sendPostRequest, file: ServiceHelpers");n.sendAjax(o,"caller: sendPostRequest, file: ServiceHelpers")}t.addArgsToUrl=i;t.sendPostRequest=r})(t=n.Service||(n.Service={}))}(BingAtWork||(BingAtWork={})),function(n){var t;(function(n){var t=function(){function t(n){this.config=n;this.tokenApiUrl="".concat(n.apiUriBase,"/v3/user/token")}return t.prototype.getToken=function(t,i,r){var u=n.addArgsToUrl(this.config,"".concat(this.tokenApiUrl,"/").concat(r),{});n.sendPostRequest(u,t,i)},t}();n.TokenClient=t})(t=n.Service||(n.Service={}))}(BingAtWork||(BingAtWork={})),function(n){var t;(function(t){var i;(function(t){function c(n){var t=n&&n.AnswerEntityRequests&&n.AnswerEntityRequests[0];return t&&t.Query&&t.Query.QueryString}function l(n){return n&&n.AnswerEntitySets&&n.AnswerEntitySets[0]}function a(n){var r,f,e,t,i;return u(n)?(i=n,((e=i===null||i===void 0?void 0:i.Ranking)===null||e===void 0?void 0:e.Placement)||"Suppress"):(t=n,((f=(r=t===null||t===void 0?void 0:t.WholePageRankings)===null||r===void 0?void 0:r[0])===null||f===void 0?void 0:f.Placement)||"Suppress")}function v(n){var t,i,r=p(n);if((i=(t=r===null||r===void 0?void 0:r.EntityCards)===null||t===void 0?void 0:t[0])!==null&&i!==void 0)return i.CardType}function y(n){var t=n&&n.AnswerEntitySets;if(t)return t.some(function(n){return n.ResultSets&&n.ResultSets.some(function(n){return n.Results&&n.Results.some(function(n){return!!n.Source&&!!n.Source.powerApp})})})}function p(n){var i,t,r;return u(n)?(r=n,r.Ranking):(t=n,(i=t===null||t===void 0?void 0:t.WholePageRankings)===null||i===void 0?void 0:i[0])}function u(n){return!!n&&!("EntitySets"in n)}var i=n.context,f=i.isSubstratePeriodicWarmup,e=i.useMailboxHdr,o=i.tenantId,r=i.uiCulture,s=i.isBingSpellerEnabled,h=function(){function t(n,t){this.substrateSearchCfg=n;this.getSubstrateToken=t;this.isPrimed=!1}return t.prototype.search=function(n,t,i,r,u){var f=this;this.substrateSearchCfg.is3sPrimingEnabled&&this.primeConnection();this.getSubstrateToken(undefined,{onSuccess:function(e){return f.searchImpl(e.token,n,t,i,r,u)},onError:t.onError})},t.prototype.searchResolveEntitiesAsync=function(n,t,i,r,u){var f=this;this.getSubstrateToken(undefined,{onSuccess:function(e){return f.searchResolveEntitiesAsyncImpl(e.token,n,t,i,r,u)},onError:t.onError})},t.prototype.warmUp=function(t,i){var u=this,r;this.substrateSearchCfg.is3sPrimingEnabled&&this.primeConnection();r={onSuccess:function(n){return u.warmUpImpl(n.token,t,i)},onError:function(t,i,r){return sj_evt.fire("bfbSubstrateWarmupFailed",t,i,r,n.getFailedEventDetails(t,i))}};f?this.getSubstrateToken(r):this.getSubstrateToken(undefined,r)},t.prototype.searchImpl=function(t,i,r,u,f,e){var o,s,v=this.substrateSearchCfg.substrateApiUri,h=n.mergeArgsIntoUrl(v.concat("/v2/query"),e),c=this.getHeader(t,"POST",f),l,a;if(sj_evt.fire(u,n.getStartedEventDetails()),l=n.context.isCachingSubstrateResponseEnabled,a=(s=(o=n===null||n===void 0?void 0:n.Service)===null||o===void 0?void 0:o.Midgard)===null||s===void 0?void 0:s.getSubstrateUnifiedResponseInSession(),l&&a){r.onSuccess(a,undefined,{url:h,token:t,headers:c,request:i},!0);return}this.sendRequest(h,i,{onSuccess:function(u,f){var e,o;l&&((o=(e=n===null||n===void 0?void 0:n.Service)===null||e===void 0?void 0:e.Midgard)===null||o===void 0?void 0:o.saveSubstrateUnifiedResponseInSession(u));r.onSuccess(u,f,{url:h,token:t,headers:c,request:i},!1)},onError:r.onError},null,t,c)},t.prototype.searchResolveEntitiesAsyncImpl=function(t,i,r,u,f,e){var o=this.substrateSearchCfg.substrateApiUri,s=n.mergeArgsIntoUrl(o.concat("/v1/resolveEntitiesAsync"),e),h=this.getHeader(t,"POST",f);sj_evt.fire(u,n.getStartedEventDetails());this.sendRequest(s,i,r,null,t,h)},t.prototype.getHeader=function(t,i,u){var f,h,c;if(i===void 0&&(i="POST"),f={},e){if(!this.anchorMailboxHeaderValue){var l=n.parseJwt(t),a=l.token,v=l.error,y=a&&a.puid;y?this.anchorMailboxHeaderValue="PUID:".concat(y,"@").concat(o):(h="SubstrateSearchClient: cannot add x-anchormailbox header. PUID is not available.",v&&(h+=" Error: ".concat(String(v))),n.whenWebTelemetryExists(function(){return bfbTel.logDiag(h)}))}this.anchorMailboxHeaderValue&&(f["x-anchormailbox"]=this.anchorMailboxHeaderValue)}if(i==="POST"&&(f["Content-Type"]="application/json"),u)for(c in u)f[c]=u[c];return s&&r&&(f["Accept-Language"]=r),f},t.prototype.primeConnection=function(){var i=this.substrateSearchCfg.substrateApiUri,n,t;this.isPrimed||(this.isPrimed=!0,n=_d.createElement("link"),n.rel="preconnect",n.href=i,n.crossOrigin="anonymous",_d.head.appendChild(n),t=_d.createElement("link"),t.rel="dns-prefetch",t.href=i,_d.head.appendChild(t))},t.prototype.warmUpImpl=function(t,i,r){var v=this,u=this.substrateSearchCfg,y=u.defaultScenario,o=u.personAutosuggestScenario,p=u.substrateApiUri,f=p.concat("/v2/init?cvid=".concat(_G.IG)),e=this.getHeader(t,"GET"),s=i("bfbSubstrateWarmup","bfbSubstrateWarmupFailed"),h,c,l,a;r&&r.length>0?r.forEach(function(i){var r="".concat(f,"&scenario=").concat(i);sj_evt.fire("bfbSubstrateWarmupStarted",n.getStartedEventDetails());v.sendRequest(r,{},s,null,t,e,"GET")}):(h=y,c="".concat(f,"&scenario=").concat(h),sj_evt.fire("bfbSubstrateWarmupStarted",n.getStartedEventDetails()),this.sendRequest(c,{},s,null,t,e,"GET"),n.isSubstrateWarmupV2DefaultStarted=!0);o&&(l="".concat(f,"&scena